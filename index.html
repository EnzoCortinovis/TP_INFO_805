<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="favicon.svg" />
    <link rel="stylesheet" href="style.css">
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>TP</title>
  </head>
  <body>
    <canvas id="bg"></canvas>

    <script src="https://threejs.org/build/three.js"></script> 
    <script type="module">

      import {OrbitControls} from 'https://threejsfundamentals.org/threejs/resources/threejs/r122/examples/jsm/controls/OrbitControls.js';
      const scene = new THREE.Scene();

      const camera = new THREE.PerspectiveCamera(75 ,window.innerWidth / window.innerHeight, 0.1, 1000 );

      const renderer = new THREE.WebGLRenderer({
        canvas: document.querySelector('#bg'),
      });

      const spaceTexture = new THREE.TextureLoader().load('space.jpg');
      scene.background = spaceTexture;

      // terre 

      const earthTexture = new THREE.TextureLoader().load('images/earth_atmos_2048.jpg');
      const normalTexture = new THREE.TextureLoader().load('images/earth_normal_2048.jpg');

      const earth = new THREE.Mesh(
        new THREE.SphereGeometry(3, 32, 32),
        new THREE.MeshStandardMaterial({
          map: earthTexture,
          normalMap: normalTexture,
        })
      );

      scene.add(earth)


      // Lights

      const pointLight = new THREE.PointLight(0xffffff);
      pointLight.position.set(5, 5, 5);

      const ambientLight = new THREE.AmbientLight(0xffffff);
      scene.add(pointLight, ambientLight);

      const lightHelper = new THREE.PointLightHelper(pointLight)
      const gridHelper = new THREE.GridHelper(200, 50)
      scene.add(lightHelper, gridHelper)


      // Controls and Cam

      renderer.setPixelRatio( window.devicePixelRatio);
      renderer.setSize( window.innerWidth, window.innerHeight);
      camera.position.setZ(30);

      const controls = new OrbitControls(camera, renderer.domElement);

      let starsGroup = new THREE.Group();


      // Functions

      function addStar(){
        const geometry = new THREE.SphereGeometry(0.25, 24, 24);
        const material = new THREE.MeshStandardMaterial({ color: 0xffffff });
        const star = new THREE.Mesh(geometry, material);

        const [x, y, z] = Array(3).fill().map(() => THREE.MathUtils.randFloatSpread(100)); // génère tab de 3 valeurs rdm entre -100 et 100

        star.position.set(x, y, z);
        starsGroup.add(star)
        
        return star
      }
      scene.add(starsGroup);
      let testTab = []
      for (let i = 0; i < 199; i++) {
        testTab[i] = addStar()
      }
      //let tab = Array(200).fill().forEach(addStar); // creer 200 étoiles
      let fruits = ['Apple', 'Banana'];

      function animate(){
        requestAnimationFrame(animate);
        earth.rotation.y += 0.005;
        starsGroup.rotation.y += 0.05;
        
        
        // testTab.forEach(function(item, index, array) {
        //   console.log(item, index);
        //   item.position.set(0,10,1)
        // });
        controls.update();

        renderer.render( scene, camera );
        
        
      }

      animate()
      
    </script>
  </body>
</html>
